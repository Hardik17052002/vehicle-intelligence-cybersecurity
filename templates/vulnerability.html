<!DOCTYPE html>
<html>
<head>
    <title>AI Threat Scanner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Socket.IO Client - CRITICAL: Load before custom JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body {
            background: #080818;
            color: #eee;
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            padding: 20px;
        }

        .scanner-container {
            background: rgba(20, 20, 50, 0.95);
            border: 1px solid #8800ff;
            border-radius: 15px;
            padding: 25px;
            margin: 30px auto;
            width: 90%;
            box-shadow: 0 0 30px rgba(136, 0, 255, 0.3);
        }
        
        .realtime-scanner-container {
            background: rgba(20, 50, 20, 0.95);
            border: 1px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            margin: 30px auto;
            width: 90%;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        
        .scan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .scan-visualization {
            height: 200px;
            background: #0a0a2a;
            border: 1px solid #00b8ff;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .realtime-visualization {
            height: 200px;
            background: #0a2a0a;
            border: 1px solid #00ff88;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .scan-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20%;
            background: linear-gradient(90deg, transparent, rgba(136, 0, 255, 0.3), transparent);
            animation: wave 3s linear infinite;
        }
        
        .realtime-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.3), transparent);
            animation: wave 2s linear infinite;
        }
        
        @keyframes wave {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .threat-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .threat-card {
            background: rgba(40, 20, 60, 0.8);
            border: 1px solid #00b8ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
            color: #eee;
        }
        
        .realtime-threat-card {
            background: rgba(20, 60, 40, 0.8);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
            color: #eee;
            animation: fadeIn 0.5s ease-in;
        }
        
        .threat-card.critical, .realtime-threat-card.critical {
            border-color: #ff0055;
            background: rgba(70, 0, 30, 0.8);
        }
        
        .threat-card.high, .realtime-threat-card.high {
            border-color: #ff9800;
            background: rgba(70, 40, 0, 0.8);
        }
        
        .threat-card:hover, .realtime-threat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(136, 0, 255, 0.5);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .threat-severity {
            width: 100%;
            height: 5px;
            background: #333;
            margin: 10px 0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .severity-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b8ff, #ffaa00, #ff0055);
        }
        
        .ai-recommendation {
            background: rgba(20, 20, 60, 0.8);
            border-left: 3px solid #00b8ff;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .realtime-recommendation {
            background: rgba(20, 60, 20, 0.8);
            border-left: 3px solid #00ff88;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .scan-btn {
            background: #8800ff;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            transition: all 0.3s;
        }

        .scan-btn:hover {
            background: #aa33ff;
            transform: translateY(-2px);
        }
        
        .realtime-btn {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            transition: all 0.3s;
        }

        .realtime-btn:hover {
            background: #33ffaa;
            transform: translateY(-2px);
        }

        .mitigate-btn {
            background: #00b8ff;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .mitigate-btn:hover {
            background: #33ccff;
        }
        
        .realtime-mitigate-btn {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .realtime-mitigate-btn:hover {
            background: #33ffaa;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(136, 0, 255, 0.3);
        }
        
        .realtime-stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #8800ff;
        }
        
        .realtime-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .realtime-log {
            background: #0a1a0a;
            color: #00ff88;
            font-family: monospace;
            padding: 15px;
            border-radius: 10px;
            height: 200px;
            overflow-y: auto;
            border: 2px solid #00ff88;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .log-line {
            margin-bottom: 3px;
            animation: fadeIn 0.3s ease-in;
        }
        
        .log-line.critical {
            color: #ff0055;
            font-weight: bold;
        }
        
        .log-line.high {
            color: #ff9800;
        }
        
        .log-line.info {
            color: #00b8ff;
        }
    </style>
</head>
<body>
    <!-- SIMULATED AI THREAT SCANNER -->
    <div class="scanner-container">
        <div class="scan-header">
            <h1><i class="fas fa-robot"></i> AI Threat Scanner (Simulated)</h1>
            <div class="scan-controls">
                <button class="scan-btn" onclick="startAIScan()">
                    <i class="fas fa-play"></i> Start Smart Scan
                </button>
                <button class="scan-btn" onclick="clearSimulatedThreats()">
                    <i class="fas fa-trash"></i> Clear Results
                </button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="simThreatsFound">0</div>
                <div class="stat-label">Threats Found</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="simVulnsScanned">0</div>
                <div class="stat-label">Vulnerabilities Scanned</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="simRiskScore">0</div>
                <div class="stat-label">Risk Score</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="simScanProgress">0%</div>
                <div class="stat-label">Scan Progress</div>
            </div>
        </div>
        
        <div class="scan-visualization" id="scanViz">
            <div class="scan-wave"></div>
            <div id="scanProgress" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                Ready to scan
            </div>
        </div>
        
        <div class="threat-matrix" id="threatMatrix">
            <!-- AI-detected threats will appear here -->
        </div>
        
        <div class="ai-recommendation" id="aiRecommendation">
            <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
            <p>No recommendations yet. Run a scan to get AI-powered security advice.</p>
        </div>
    </div>

    <!-- REAL-TIME AI THREAT SCANNER -->
    <div class="realtime-scanner-container">
        <div class="scan-header">
            <h1><i class="fas fa-satellite-dish"></i> Real-Time AI Threat Scanner</h1>
            <div class="scan-controls">
                <button class="realtime-btn" id="startRealtimeBtn" onclick="startRealtimeScanning()">
                    <i class="fas fa-play"></i> Start Real-Time Scan
                </button>
                <button class="realtime-btn" id="stopRealtimeBtn" onclick="stopRealtimeScanning()">
                    <i class="fas fa-stop"></i> Stop Scan
                </button>
                <button class="realtime-btn" onclick="clearRealtimeThreats()">
                    <i class="fas fa-trash"></i> Clear Results
                </button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="realtime-stat-item">
                <div class="realtime-stat-value" id="realtimeThreatsFound">0</div>
                <div class="stat-label">Live Threats</div>
            </div>
            <div class="realtime-stat-item">
                <div class="realtime-stat-value" id="realtimePacketsAnalyzed">0</div>
                <div class="stat-label">Packets Analyzed</div>
            </div>
            <div class="realtime-stat-item">
                <div class="realtime-stat-value" id="realtimeStatus">Inactive</div>
                <div class="stat-label">Scanner Status</div>
            </div>
            <div class="realtime-stat-item">
                <div class="realtime-stat-value" id="realtimeUptime">0s</div>
                <div class="stat-label">Scan Uptime</div>
            </div>
        </div>
        
        <div class="realtime-visualization" id="realtimeViz">
            <div class="realtime-wave"></div>
            <div id="realtimeProgress" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                Click "Start Real-Time Scan" to begin live monitoring
            </div>
        </div>
        
        <div class="realtime-log" id="realtimeLog">
> Real-time threat scanner ready. Click start to begin live monitoring...
        </div>
        
        <div class="threat-matrix" id="realtimeThreatMatrix">
            <!-- Real-time detected threats will appear here -->
        </div>
        
        <div class="realtime-recommendation" id="realtimeRecommendation">
            <h3><i class="fas fa-shield-alt"></i> Live Security Recommendations</h3>
            <p>No real-time recommendations yet. Start scanning to get live AI-powered security analysis.</p>
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        
        // Global variables
        let realtimeActive = false;
        let realtimeThreats = 0;
        let realtimePackets = 0;
        let startTime = null;
        let uptimeInterval = null;
        
        // SIMULATED SCANNER FUNCTIONS
        function startAIScan() {
            const scanViz = document.getElementById('scanViz');
            const scanProgress = document.getElementById('scanProgress');
            const threatMatrix = document.getElementById('threatMatrix');
            
            threatMatrix.innerHTML = '';
            scanViz.style.background = '#0a0a2a';
            scanProgress.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Initializing AI scan...';
            
            // Update progress stats
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                document.getElementById('simScanProgress').textContent = Math.floor(progress) + '%';
                document.getElementById('simVulnsScanned').textContent = Math.floor(progress * 0.5);
                if (progress >= 100) clearInterval(progressInterval);
            }, 500);
            
            setTimeout(() => {
                scanProgress.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mapping network topology...';
                scanViz.style.background = 'linear-gradient(to bottom, #0a0a2a, #0a203a)';
            }, 1500);
            
            setTimeout(() => {
                scanProgress.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing services...';
                scanViz.style.background = 'linear-gradient(to bottom, #0a0a2a, #0a304a)';
            }, 3000);
            
            setTimeout(() => {
                scanProgress.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Detecting vulnerabilities...';
                scanViz.style.background = 'linear-gradient(to bottom, #0a0a2a, #0a405a)';
            }, 4500);
            
            setTimeout(() => {
                scanProgress.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running ML threat prediction...';
                scanViz.style.background = 'linear-gradient(to bottom, #0a0a2a, #0a506a)';
            }, 6000);
            
            setTimeout(() => {
                const threatCount = 4;
                scanProgress.innerHTML = `<i class="fas fa-check-circle"></i> Scan complete! Threats detected: ${threatCount}`;
                scanViz.style.background = 'linear-gradient(to bottom, #0a0a2a, #0a607a)';
                
                document.getElementById('simThreatsFound').textContent = threatCount;
                document.getElementById('simRiskScore').textContent = '7.8';
                document.getElementById('simScanProgress').textContent = '100%';
                document.getElementById('simVulnsScanned').textContent = '50';
                
                addSimulatedThreat("CVE-2023-1234", "Apache HTTP Server RCE", 9.8, "critical");
                addSimulatedThreat("CVE-2023-5678", "OpenSSL Buffer Overflow", 7.5, "high");
                addSimulatedThreat("Weak SSH Configuration", "Brute force vulnerable", 5.0, "medium");
                addSimulatedThreat("Exposed Admin Interface", "Unauthorized access possible", 6.1, "high");
                
                document.getElementById('aiRecommendation').innerHTML = `
                    <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
                    <p><strong>1.</strong> Patch Apache server immediately (CVE-2023-1234)</p>
                    <p><strong>2.</strong> Update OpenSSL to version 3.0.7+</p>
                    <p><strong>3.</strong> Implement fail2ban for SSH protection</p>
                    <p><strong>4.</strong> Restrict access to admin interface</p>
                `;
            }, 7500);
        }
        
        function addSimulatedThreat(cve, description, severity, level) {
            const threatMatrix = document.getElementById('threatMatrix');
            
            const threatCard = document.createElement('div');
            threatCard.className = `threat-card ${level}`;
            threatCard.innerHTML = `
                <h4><i class="fas fa-bug"></i> ${cve}</h4>
                <p>${description}</p>
                <div class="threat-severity">
                    <div class="severity-bar" style="width: ${severity * 10}%"></div>
                </div>
                <p>Severity: ${severity}/10</p>
                <button class="mitigate-btn" onclick="mitigateThreat('${cve}')">
                    <i class="fas fa-shield-alt"></i> Mitigate
                </button>
            `;
            
            threatMatrix.appendChild(threatCard);
        }
        
        function clearSimulatedThreats() {
            document.getElementById('threatMatrix').innerHTML = '';
            document.getElementById('simThreatsFound').textContent = '0';
            document.getElementById('simVulnsScanned').textContent = '0';
            document.getElementById('simRiskScore').textContent = '0';
            document.getElementById('simScanProgress').textContent = '0%';
            document.getElementById('scanProgress').textContent = 'Ready to scan';
            document.getElementById('scanViz').style.background = '#0a0a2a';
            document.getElementById('aiRecommendation').innerHTML = `
                <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
                <p>No recommendations yet. Run a scan to get AI-powered security advice.</p>
            `;
        }
        
        function mitigateThreat(cve) {
            alert(`Mitigation started for ${cve}\n(Action would be automated in full implementation)`);
        }
        
        // REAL-TIME SCANNER FUNCTIONS
        function startRealtimeScanning() {
            if (realtimeActive) return;
            
            realtimeActive = true;
            startTime = Date.now();
            document.getElementById('realtimeStatus').textContent = 'Active';
            document.getElementById('realtimeProgress').innerHTML = '<i class="fas fa-satellite-dish fa-spin"></i> Real-time monitoring active...';
            document.getElementById('realtimeViz').style.background = 'linear-gradient(to bottom, #0a2a0a, #0a4a0a)';
            
            const log = document.getElementById('realtimeLog');
            log.innerHTML = '> Real-time scanner started\n> Connecting to network interfaces...\n> AI threat detection active\n';
            
            // Start uptime counter
            uptimeInterval = setInterval(updateUptime, 1000);
            
            console.log('üöÄ Starting real-time threat scanning...');
        }
        
        function stopRealtimeScanning() {
            if (!realtimeActive) return;
            
            realtimeActive = false;
            document.getElementById('realtimeStatus').textContent = 'Inactive';
            document.getElementById('realtimeProgress').textContent = 'Real-time scanning stopped';
            document.getElementById('realtimeViz').style.background = '#0a2a0a';
            
            if (uptimeInterval) {
                clearInterval(uptimeInterval);
                uptimeInterval = null;
            }
            
            const log = document.getElementById('realtimeLog');
            log.innerHTML += '\n> Real-time scanner stopped by user';
            log.scrollTop = log.scrollHeight;
            
            console.log('‚èπÔ∏è Real-time threat scanning stopped');
        }
        
        function clearRealtimeThreats() {
            document.getElementById('realtimeThreatMatrix').innerHTML = '';
            document.getElementById('realtimeThreatsFound').textContent = '0';
            document.getElementById('realtimePacketsAnalyzed').textContent = '0';
            document.getElementById('realtimeUptime').textContent = '0s';
            document.getElementById('realtimeLog').innerHTML = '> Real-time threat scanner ready. Click start to begin live monitoring...';
            document.getElementById('realtimeRecommendation').innerHTML = `
                <h3><i class="fas fa-shield-alt"></i> Live Security Recommendations</h3>
                <p>No real-time recommendations yet. Start scanning to get live AI-powered security analysis.</p>
            `;
            realtimeThreats = 0;
            realtimePackets = 0;
        }
        
        function updateUptime() {
            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const mins = Math.floor(elapsed / 60);
                const secs = elapsed % 60;
                document.getElementById('realtimeUptime').textContent = mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;
            }
        }
        
        function addRealtimeThreat(message, level, source = 'Network') {
            realtimeThreats++;
            document.getElementById('realtimeThreatsFound').textContent = realtimeThreats;
            
            // Add to threat matrix
            const threatMatrix = document.getElementById('realtimeThreatMatrix');
            const threatCard = document.createElement('div');
            threatCard.className = `realtime-threat-card ${level}`;
            threatCard.innerHTML = `
                <h4><i class="fas fa-exclamation-triangle"></i> Live Threat #${realtimeThreats}</h4>
                <p><strong>Source:</strong> ${source}</p>
                <p>${message}</p>
                <div class="threat-severity">
                    <div class="severity-bar" style="width: ${level === 'critical' ? '90' : level === 'high' ? '70' : '40'}%"></div>
                </div>
                <p>Level: ${level.toUpperCase()}</p>
                <button class="realtime-mitigate-btn" onclick="mitigateRealtimeThreat(${realtimeThreats})">
                    <i class="fas fa-shield-alt"></i> Block
                </button>
            `;
            
            threatMatrix.insertBefore(threatCard, threatMatrix.firstChild);
            
            // Limit to 10 threat cards
            while (threatMatrix.children.length > 10) {
                threatMatrix.removeChild(threatMatrix.lastChild);
            }
        }
        
        function mitigateRealtimeThreat(threatId) {
            alert(`Real-time mitigation activated for Threat #${threatId}\n(Automated response deployed)`);
        }
        
        function addRealtimeLogEntry(message, level = 'info') {
            realtimePackets++;
            document.getElementById('realtimePacketsAnalyzed').textContent = realtimePackets;
            
            const log = document.getElementById('realtimeLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-line ${level}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
            
            // Keep only last 100 entries
            while (log.children.length > 100) {
                log.removeChild(log.firstChild);
            }
        }
        
        // SOCKET.IO EVENT HANDLERS
        socket.on('connect', () => {
            console.log('‚úÖ Connected to AI Threat Scanner server');
            addRealtimeLogEntry('Connected to threat intelligence server', 'info');
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Disconnected from server');
            addRealtimeLogEntry('Disconnected from server - attempting reconnection', 'critical');
        });
        
        // Listen for real-time threats from tshark and other listeners
        socket.on('realtime_threat', (data) => {
            console.log('üéØ RECEIVED REAL-TIME THREAT:', data);
            
            if (realtimeActive) {
                addRealtimeLogEntry(`THREAT: ${data.message}`, data.level);
                addRealtimeThreat(data.message, data.level, 'Network Scanner');
                
                // Update recommendations based on threat type
                const recommendations = document.getElementById('realtimeRecommendation');
                recommendations.innerHTML = `
                    <h3><i class="fas fa-shield-alt"></i> Live Security Recommendations</h3>
                    <p><strong>Latest Threat:</strong> ${data.message}</p>
                    <p><strong>Recommended Action:</strong> ${getRecommendation(data.level, data.message)}</p>
                    <p><strong>Risk Level:</strong> ${data.level.toUpperCase()}</p>
                `;
            }
        });
        
        // Listen for IDS alerts
        socket.on('ids_alert', (data) => {
            console.log('üõ°Ô∏è RECEIVED IDS ALERT:', data);
            
            if (realtimeActive) {
                addRealtimeLogEntry(`IDS: ${data.message}`, data.level);
                if (data.level === 'critical' || data.level === 'high') {
                    addRealtimeThreat(data.message, data.level, 'IDS System');
                }
            }
        });
        
        function getRecommendation(level, message) {
            if (level === 'critical') {
                return 'Immediate isolation and investigation required';
            } else if (level === 'high') {
                return 'Block source IP and review security policies';
            } else {
                return 'Monitor closely and update threat signatures';
            }
        }
        
        console.log('‚úÖ AI Threat Scanner initialized successfully!');
    </script>
</body>
</html>
