<!DOCTYPE html>
<html>
<head>
    <title>Auto-Pentest Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: url('../static/cyber_matrix_bg.gif') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Orbitron', sans-serif;
            color: #00ff88;
            margin: 0;
            padding: 20px;
        }
        
        .pentest-container {
            background: rgba(10, 20, 40, 0.9);
            border: 1px solid #bd00ff;
            border-radius: 15px;
            padding: 25px;
            margin: 0 auto;
            width: 90%;
            box-shadow: 0 0 30px rgba(189, 0, 255, 0.3);
        }
        
        .exploit-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .exploit-card {
            background: rgba(20, 10, 30, 0.7);
            border: 1px solid #00b8ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .exploit-card.critical {
            border-color: #ff0055;
            background: rgba(40, 0, 10, 0.7);
        }
        
        .terminal {
            background: #0a0a1a;
            color: #00ff88;
            font-family: monospace;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            height: 200px;
            overflow-y: scroll;
            border: 1px solid #00ff88;
        }
        
        .progress-container {
            width: 100%;
            background: #0a1420;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, #00ff88, #bd00ff);
            width: 0%;
            transition: width 0.5s;
        }

        /* Real-time output styles */
        .realtime-section {
            margin-top: 30px;
            border-top: 2px solid #bd00ff;
            padding-top: 20px;
        }

        .realtime-output {
            background: #0a0a1a;
            color: #00ff88;
            font-family: monospace;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #bd00ff;
            margin-top: 10px;
        }

        .realtime-event {
            margin: 2px 0;
            padding: 2px 0;
        }

        .realtime-event.critical { color: #ff0055; }
        .realtime-event.high { color: #ff9800; }
        .realtime-event.medium { color: #ffeb3b; }
        .realtime-event.info { color: #00b8ff; }

        .realtime-controls {
            margin: 15px 0;
        }

        .realtime-btn {
            background: linear-gradient(45deg, #bd00ff, #8a2be2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .realtime-btn:hover {
            background: linear-gradient(45deg, #8a2be2, #bd00ff);
        }

        .realtime-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group input, .input-group select {
            padding: 10px;
            background: rgba(10, 10, 20, 0.8);
            border: 1px solid #bd00ff;
            border-radius: 5px;
            color: #00ff88;
            font-family: 'Orbitron', sans-serif;
            flex: 1;
        }

        .input-group button {
            padding: 10px 20px;
            background: linear-gradient(45deg, #bd00ff, #8a2be2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
        }

        .input-group button:hover {
            background: linear-gradient(45deg, #8a2be2, #bd00ff);
        }

        .exploit-card button {
            background: linear-gradient(45deg, #00ff88, #00b8ff);
            color: #0a0a0a;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            margin-top: 10px;
        }

        .exploit-card button:hover {
            background: linear-gradient(45deg, #00b8ff, #00ff88);
        }
    </style>
</head>
<body>
    <div class="pentest-container">
        <h1><i class="fas fa-bomb"></i> Auto-Pentest Suite</h1>
        
        <!-- INPUT SECTION -->
        <div class="input-group">
            <input type="text" id="targetHost" placeholder="Target IP/Hostname">
            <select id="testType">
                <option value="web">Web Application</option>
                <option value="network">Network Service</option>
                <option value="os">Operating System</option>
            </select>
            <button onclick="runPentest()"><i class="fas fa-play"></i> Run Test</button>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="pentestProgress"></div>
        </div>
        
        <div class="exploit-list" id="exploitList">
            <!-- Exploits will be populated here -->
        </div>
        
        <h3><i class="fas fa-terminal"></i> Exploit Console</h3>
        <div class="terminal" id="pentestTerminal">
            > Auto-Pentest Suite initialized. Ready for commands.
        </div>

        <!-- Real-time pentest section -->
        <div class="realtime-section">
            <h3><i class="fas fa-satellite-dish"></i> Real-Time Pentest Scanner</h3>
            <div class="realtime-controls">
                <button id="toggle-realtime-pentest" class="realtime-btn">Show Real-Time Scanner</button>
                <button id="start-realtime-pentest" class="realtime-btn" style="display:none;">Start Real-Time Scan</button>
                <button id="stop-realtime-pentest" class="realtime-btn" style="display:none;" disabled>Stop Scan</button>
            </div>
            
            <div id="realtime-pentest-panel" style="display:none;">
                <h4>Live Pentest Output</h4>
                <div id="realtime-pentest-output" class="realtime-output">
                    <p style="opacity: 0.6;">Connecting to real-time pentest scanner...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Socket.IO client -->
    <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>

    <script>
        const EXPLOITS = {
            web: [
                { name: "SQL Injection", successRate: 85, severity: "high" },
                { name: "XSS Attack", successRate: 70, severity: "medium" },
                { name: "Command Injection", successRate: 60, severity: "critical" }
            ],
            network: [
                { name: "SSH Brute Force", successRate: 40, severity: "high" },
                { name: "SMB Exploit", successRate: 75, severity: "critical" },
                { name: "FTP Bounce", successRate: 30, severity: "medium" }
            ],
            os: [
                { name: "Kernel Exploit", successRate: 55, severity: "critical" },
                { name: "Privilege Escalation", successRate: 65, severity: "high" },
                { name: "Service Exploit", successRate: 45, severity: "medium" }
            ]
        };
        
        // EXISTING SIMULATED FUNCTIONALITY (unchanged)
        function runPentest() {
            const target = document.getElementById('targetHost').value;
            const testType = document.getElementById('testType').value;
            const terminal = document.getElementById('pentestTerminal');
            const progressBar = document.getElementById('pentestProgress');
            
            if (!target) {
                terminal.innerHTML += "\n> Error: Please enter a target";
                terminal.scrollTop = terminal.scrollHeight;
                return;
            }
            
            // Reset UI
            document.getElementById('exploitList').innerHTML = '';
            terminal.innerHTML = '> Starting automated penetration test...';
            progressBar.style.width = '0%';
            
            // Simulate pentest progress
            simulateProgress(progressBar, terminal, () => {
                terminal.innerHTML += "\n> Scan complete! Found vulnerabilities:";
                
                // Display found exploits
                EXPLOITS[testType].forEach(exploit => {
                    addExploitCard(exploit);
                    terminal.innerHTML += `\n> - ${exploit.name} (${exploit.severity})`;
                });
                
                terminal.innerHTML += "\n> Ready for manual exploitation";
                terminal.scrollTop = terminal.scrollHeight;
            });
        }
        
        function simulateProgress(progressBar, terminal, callback) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                progressBar.style.width = `${Math.min(progress, 100)}%`;
                
                if (progress < 30) {
                    terminal.innerHTML += "\n> Scanning open ports...";
                } else if (progress < 60) {
                    terminal.innerHTML += "\n> Fingerprinting services...";
                } else if (progress < 90) {
                    terminal.innerHTML += "\n> Testing for vulnerabilities...";
                }
                
                terminal.scrollTop = terminal.scrollHeight;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    callback();
                }
            }, 800);
        }
        
        function addExploitCard(exploit) {
            const card = document.createElement('div');
            card.className = `exploit-card ${exploit.severity}`;
            card.innerHTML = `
                <h4><i class="fas fa-bug"></i> ${exploit.name}</h4>
                <p>Severity: <span class="severity-${exploit.severity}">${exploit.severity}</span></p>
                <p>Success Rate: ${exploit.successRate}%</p>
                <button onclick="runExploit('${exploit.name}')">
                    <i class="fas fa-rocket"></i> Execute
                </button>
            `;
            document.getElementById('exploitList').appendChild(card);
        }
        
        function runExploit(exploitName) {
            const terminal = document.getElementById('pentestTerminal');
            terminal.innerHTML += `\n> Executing ${exploitName}...`;
            
            setTimeout(() => {
                const success = Math.random() > 0.3;
                if (success) {
                    terminal.innerHTML += `\n> ${exploitName} succeeded! Shell access gained.`;
                } else {
                    terminal.innerHTML += `\n> ${exploitName} failed. Target may be patched.`;
                }
                terminal.scrollTop = terminal.scrollHeight;
            }, 2000);
        }

        // Real-time pentest functionality
        const socket = io();
        let realtimeScanRunning = false;

        // Toggle real-time panel visibility
        const toggleBtn = document.getElementById('toggle-realtime-pentest');
        const startBtn = document.getElementById('start-realtime-pentest');
        const stopBtn = document.getElementById('stop-realtime-pentest');
        const panel = document.getElementById('realtime-pentest-panel');

        toggleBtn.addEventListener('click', () => {
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                toggleBtn.innerText = 'Hide Real-Time Scanner';
                startBtn.style.display = 'inline-block';
                if (realtimeScanRunning) {
                    stopBtn.style.display = 'inline-block';
                }
            } else {
                panel.style.display = 'none';
                toggleBtn.innerText = 'Show Real-Time Scanner';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'none';
            }
        });

        // Start real-time pentest scan
        startBtn.addEventListener('click', () => {
            if (realtimeScanRunning) return;

            const target = document.getElementById('targetHost').value || '127.0.0.1';
            const scanType = document.getElementById('testType').value;

            console.log('Starting real-time pentest scan...');
            socket.emit('start_pentest', {
                target: target,
                scan_type: scanType
            });

            realtimeScanRunning = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            stopBtn.style.display = 'inline-block';
        });

        // Stop real-time scan
        stopBtn.addEventListener('click', () => {
            if (!realtimeScanRunning) return;

            console.log('Stopping real-time pentest scan...');
            socket.emit('stop_pentest');

            realtimeScanRunning = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
        });

        // Socket.IO event handlers
        socket.on('connect', function() {
            console.log('‚úÖ Connected to pentest server');
            const outputDiv = document.getElementById('realtime-pentest-output');
            if (outputDiv && outputDiv.textContent.includes('Connecting')) {
                outputDiv.innerHTML = '<p style="color: #00b8ff;">‚úì Connected - Real-time scanner ready</p>';
            }
        });

        socket.on('pentest_output', function(data) {
            console.log('üéØ RECEIVED PENTEST OUTPUT:', data);
            const outputDiv = document.getElementById('realtime-pentest-output');
            
            if (outputDiv) {
                // Remove placeholder message on first event
                const placeholder = outputDiv.querySelector('p[style*="opacity"]');
                if (placeholder && placeholder.textContent.includes('Connecting')) {
                    outputDiv.innerHTML = '';
                }

                const msg = `[${data.timestamp}] ${data.message}`;
                const eventDiv = document.createElement('div');
                eventDiv.className = `realtime-event ${data.level || 'info'}`;
                eventDiv.textContent = msg;

                outputDiv.appendChild(eventDiv);

                // Keep only last 100 messages
                while (outputDiv.children.length > 100) {
                    outputDiv.removeChild(outputDiv.firstChild);
                }

                // Auto-scroll new messages into view
                outputDiv.scrollTop = outputDiv.scrollHeight;
            }
        });

        socket.on('pentest_started', function(data) {
            console.log('Pentest started:', data);
            const outputDiv = document.getElementById('realtime-pentest-output');
            if (outputDiv) {
                outputDiv.innerHTML = `<p style="color: #00ff88;">üöÄ Pentest started against ${data.target} (${data.scan_type})</p>`;
            }
        });

        socket.on('disconnect', function() {
            console.log('‚ùå Disconnected from server');
            const outputDiv = document.getElementById('realtime-pentest-output');
            if (outputDiv) {
                outputDiv.innerHTML = '<p style="color: #ff0055;">‚úó Disconnected - Attempting to reconnect...</p>';
            }
            realtimeScanRunning = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
        });
    </script>
</body>
</html>
